
/*Calculate the total number of trips per day*/

SELECT COUNT(*) as CN, CONVERT(DATE,PICKUP_DATETIME,112) AS PICKUP_DATE FROM [dbo].[TRIPS_FACT]
WHERE PICKUP_DATETIME>='2023.01.01' AND PICKUP_DATETIME<'2023.02.01'
GROUP BY CONVERT(DATE,PICKUP_DATETIME,112)
ORDER BY CONVERT(DATE,PICKUP_DATETIME,112)


/*Identify the top 5 zones with the highest total fare amount */
WITH CTE AS(
SELECT PICKUP_LOCATION_ID,FARE_AMOUNT,TOTAL_AMOUNT, RANK() OVER(PARTITION BY TRIP_SRC ORDER BY TOTAL_AMOUNT DESC)  TRIP_DTL
FROM [dbo].[TRIPS_FACT])

SELECT SERVICE_ZONE,A.* FROM CTE A
LEFT JOIN LOCATION_DIM B
ON A.PICKUP_LOCATION_ID=B.LOCATION_ID WHERE TRIP_DTL<=5


/*Calculate the average trip distance by borough*/
SELECT AVG(TRIP_DISTANCE),B.BOROUGH FROM TRIPS_FACT A
LEFT JOIN LOCATION_DIM B
ON A.PICKUP_LOCATION_ID=B.LOCATION_ID 
GROUP BY B.BOROUGH 


/*Determine the most common pickup and dropoff locations*/

SELECT TOP 1 * FROM 
(SELECT COUNT(*) AS CN,SERVICE_ZONE 
FROM TRIPS_FACT A
LEFT JOIN LOCATION_DIM B
ON A.PICKUP_LOCATION_ID=B.LOCATION_ID 
GROUP BY SERVICE_ZONE 
) A
ORDER BY CN DESC

SELECT TOP 1 * FROM 
(SELECT COUNT(*) AS CN,SERVICE_ZONE 
FROM TRIPS_FACT A
LEFT JOIN LOCATION_DIM B
ON A.DROPOFF_LOCATION_ID=B.LOCATION_ID 
GROUP BY SERVICE_ZONE 
) A
ORDER BY CN DESC


/*Calculate the total tip amount per passenger count*/
SELECT SUM(TIP_AMOUNT),PASSENGER_COUNT FROM TRIPS_FACT 
GROUP BY PASSENGER_COUNT 
ORDER BY PASSENGER_COUNT

